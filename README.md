# abortable-promise-cache

[![NPM version](https://img.shields.io/npm/v/abortable-promise-cache.svg?style=flat-square)](https://npmjs.org/package/abortable-promise-cache)
[![Coverage Status](https://img.shields.io/codecov/c/github/rbuels/abortable-promise-cache/master.svg?style=flat-square)](https://codecov.io/gh/rbuels/abortable-promise-cache/branch/master)
[![Build Status](https://img.shields.io/github/actions/workflow/status/GMOD/abortable-promise-cache/push.yml?branch=master)](https://github.com/GMOD/abortable-promise-cache/actions)

Adds AbortController/AbortSignal semantics to a cache of promises. Each `get`
from the cache can optionally take an `AbortSignal` object that lets that
request be aborted.

Cached fill requests will be aborted and evicted from the cache if all the
incoming requests for it are aborted before the promise settles.

If the fill request has already settled before all the requests for it have been
aborted, it will stay in the cache.

## Install

    $ npm install --save abortable-promise-cache

## Usage

```js
import AbortablePromiseCache from 'abortable-promise-cache'
import QuickLRU from 'quick-lru'

const cache = new AbortablePromiseCache({
  // QuickLRU is a good backing cache to use, but you can use any
  // cache as long as it supports `get`, `set`, `delete`, and `keys`.
  cache: new QuickLRU({ maxSize: 1000 }),

  // the `fill` callback will be called for a cache miss
  async fill(requestData, abortSignal) {
    // do some long-running thing
    return longRunningThing(requestData, abortSignal)
  },
})

// Make a cached request. The returned promise will abort with the given abort signal if
// there is not already a cached copy that has been resolved.
// Fill requests will be signaled to abort if all the requests for them
// so far have been aborted.
const aborter = new AbortController()
const result = await cache.get('some key', { ...anyStuff }, aborter.signal)

// deleting and clearing will abort any outstanding requests
cache.delete('some key')
cache.clear()
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

## Academic Use

This package was written with funding from the [NHGRI](http://genome.gov) as
part of the [JBrowse](http://jbrowse.org) project. If you use it in an academic
project that you publish, please cite the most recent JBrowse paper, which will
be linked from [jbrowse.org](http://jbrowse.org).

## License

MIT Â© [Robert Buels](https://github.com/rbuels)
